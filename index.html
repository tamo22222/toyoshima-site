<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>とびしまカー活用のアイデア</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="hero">
  <h1>車で、豊島の暮らしを支える</h1>
  <p>呉市豊島を題材にした、移動支援の事業アイデア</p>
  <img src="images/toyoshima.jpg" alt="豊島の風景">
</header>


<section>
  <h2>背景</h2>
  <p>
    豊島では、日常の移動が必要な場面が多くあります。
    しかし、公共交通の少なさや高齢化により、
    移動そのものが負担になることもあります。
  </p>
</section>

<section class="cards">
  <div class="card">
    <h3>買い物代行</h3>
    <p>車でまとめて買い物し、島内へ届ける想定です。</p>
  </div>
  <div class="card">
    <h3>移動型そうざい販売</h3>
    <p>調理が難しい高齢者に向けた、キッチンカー兼宅配サービスを行います。</p>
  </div>
  <div class="card">
    <h3>島内なんでも便</h3>
    <p>荷物運搬やちょっとした用事を代行します。</p>
  </div>
</section>

<section id="todayStatus" class="today-status">
  <h2>本日の運行状況</h2>
  <p>読み込み中...</p>
</section>
<section id="nextStatus" class="today-status">
  <h2>次回の運行予定</h2>
  <p>読み込み中...</p>
</section>


<section class="calendar-section">
  <h2>活動予定カレンダー</h2>
  <p class="section-desc">
    移動支援カーの運行予定です。天候等により変更される場合があります。
  </p>

  <div class="calendar-wrapper">
    <iframe
      src="https://calendar.google.com/calendar/embed?src=a622c89a828f5f5b9a69926fc2b6e94696c8d5e1fce7ac30a4c45bf947aa773a%40group.calendar.google.com&ctz=Asia%2FTokyo"
      frameborder="0"
      scrolling="no">
    </iframe>
  </div>
</section>


<section>
  <h2>このアイデアについて</h2>
<iframe
  src="https://docs.google.com/forms/d/e/1FAIpQLScbmn66-B9VKijMMi0ia_doxCmfsvTQxUbrWEP2CDWDjIeh6w/viewform?embedded=true"
  width="100%"
  height="900"
  frameborder="0"
  marginheight="0"
  marginwidth="0">
読み込んでいます…
</iframe>
<p class="note">
本アンケートは、呉市豊島における移動支援サービス検討のための
意見収集を目的としています。
個人が特定される情報は収集しません。
</p>


</section>

<footer>
  <p>制作：呉高専島おこしIW</p>
</footer>

<script>
const calendarId = "a622c89a828f5f5b9a69926fc2b6e94696c8d5e1fce7ac30a4c45bf947aa773a@group.calendar.google.com";
const apiKey = "AIzaSyBW7D1JzLWRu7ld3MAVimXXiMVXq6FUt08";

function getTodayJST() {
  const now = new Date();
  const jst = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Tokyo" }));
  return jst.toISOString().split("T")[0];
}

const today = getTodayJST();
const timeMin = `${today}T00:00:00+09:00`;

const url = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events
?key=${apiKey}
&timeMin=${timeMin}
&singleEvents=true
&orderBy=startTime
&maxResults=5`;

fetch(url.replace(/\s+/g, ""))
  .then(res => res.json())
  .then(data => {
    const todayBox = document.getElementById("todayStatus");
    const nextBox = document.getElementById("nextStatus");

    if (!data.items || data.items.length === 0) {
      todayBox.classList.add("close");
      todayBox.innerHTML = `
        <h2>本日の運行状況</h2>
        <p>🔴 本日は運行していません</p>
      `;
      nextBox.innerHTML = `
        <h2>次回の運行予定</h2>
        <p>現在予定はありません</p>
      `;
      return;
    }

    const todayEvents = [];
    let nextEvent = null;

    data.items.forEach(event => {
      const startDate = (event.start.dateTime || event.start.date).slice(0, 10);
      if (startDate === today) {
        todayEvents.push(event);
      } else if (!nextEvent && startDate > today) {
        nextEvent = event;
      }
    });

    // 今日の表示
    if (todayEvents.length > 0) {
      todayBox.classList.add("open");
      const list = todayEvents.map(e => `<li>${e.summary || "運行予定"}</li>`).join("");
      todayBox.innerHTML = `
        <h2>本日の運行状況</h2>
        <p>🟢 本日は運行日です</p>
        <ul style="list-style:none; padding:0;">${list}</ul>
      `;
    } else {
      todayBox.classList.add("close");
      todayBox.innerHTML = `
        <h2>本日の運行状況</h2>
        <p>🔴 本日は運行していません</p>
      `;
    }

    // 次回の表示
    if (nextEvent) {
      const date = new Date(nextEvent.start.dateTime || nextEvent.start.date);
      const dateText = date.toLocaleDateString("ja-JP", {
        month: "numeric",
        day: "numeric",
        weekday: "short"
      });

      const timeText = nextEvent.start.dateTime
        ? date.toLocaleTimeString("ja-JP", { hour: "2-digit", minute: "2-digit" })
        : "";

      nextBox.classList.add("open");
      nextBox.innerHTML = `
        <h2>次回の運行予定</h2>
        <p><strong>${dateText} ${timeText}</strong></p>
        <p>🚗 ${nextEvent.summary || "運行予定"}</p>
      `;
    } else {
      nextBox.innerHTML = `
        <h2>次回の運行予定</h2>
        <p>現在予定はありません</p>
      `;
    }
  })
  .catch(err => {
    console.error(err);
  });
</script>


</body>
</html>
















